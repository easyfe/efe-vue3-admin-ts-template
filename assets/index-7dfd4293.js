var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,s=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&l(e,a,t[a]);if(n)for(var a of n(t))r.call(t,a)&&l(e,a,t[a]);return e},i=(e,n)=>t(e,a(n));import{e as u,r as d,a as c,c as p,A as h,h as m,j as v,k as f,F as y,O as g,l as x,n as w,i as b,w as N,o as E,z as _,G as L,K as M,L as j,m as D,D as P,a9 as k,q as O,C as z}from"./core-e904f21d.js";import{_ as I}from"./index-360377a0.js";import{g as U}from"./index-38fba92e.js";import"./ui-e9725a95.js";const C=u({name:"TheDraggableContainer"}),$=I(u(i(s({},C),{props:{grid:{default:void 0}},setup(e){const t=e,a=d([]),n=c({matchedLine:null}),o=p((()=>n.matchedLine&&n.matchedLine.row)),r=p((()=>n.matchedLine&&n.matchedLine.col)),l=p((()=>{const e={};return t.grid&&(e.backgroundImage="linear-gradient(to right, #ccc 1px, transparent 1px), linear-gradient(to bottom, #ccc 1px, transparent 1px)",e.backgroundSize=`${t.grid[0]}px ${t.grid[1]}px`),e}));return h("list",a),h("setMatchedLine",(e=>{n.matchedLine=e})),(e,a)=>(m(),v("div",{id:"the-draggable-container",class:w(["the-draggable-container",t.grid&&"the-draggable-grid"]),style:x(l.value)},[f(e.$slots,"default",{},void 0,!0),(m(!0),v(y,null,g(o.value,((e,t)=>(m(),v("span",{key:t,style:x({width:e.width+"px",height:"0",left:e.left+"px",top:e.top+"px",borderTop:"2px solid red",position:"absolute"})},null,4)))),128)),(m(!0),v(y,null,g(r.value,((e,t)=>(m(),v("span",{key:t,style:x({width:"0",height:e.height+"px",top:e.top+"px",left:e.left+"px",borderLeft:"2px solid red",position:"absolute"})},null,4)))),128))],6))}})),[["__scopeId","data-v-6b458adf"]]),T=["onMousedown"],X=u({name:"TheDraggableItem"}),Y=I(u(i(s({},X),{props:{id:{},w:{},h:{},x:{},y:{},minW:{default:10},minH:{default:10},active:{type:Boolean,default:!1}},emits:["update:active","update:x","update:y","update:w","update:h"],setup(e,{emit:t}){const a=e,n=d(b("list")),o=b("setMatchedLine"),r=d(null);let l=null,s=null,i=null,u=null;const c=p((()=>({position:"absolute",width:isNaN(Number(a.w))?a.w:a.w+"px",height:isNaN(Number(a.h))?a.h:a.h+"px",transform:`translate3d(${isNaN(Number(a.x))?a.x:a.x+"px"}, ${isNaN(Number(a.y))?a.y:a.y+"px"}, 0px)`}))),h=p((()=>[{name:"tl",style:{top:"0",left:"0",cursor:"nwse-resize",transform:"translate(-50%, -50%)"}},{name:"tm",style:{top:"0",left:"50%",cursor:"ns-resize",transform:"translate(-50%, -50%)"}},{name:"tr",style:{top:"0",right:"0",cursor:"nesw-resize",transform:"translate(50%, -50%)"}},{name:"ml",style:{top:"50%",left:"0",cursor:"ew-resize",transform:"translate(-50%, -50%)"}},{name:"mr",style:{top:"50%",right:"0",cursor:"ew-resize",transform:"translate(50%, -50%)"}},{name:"bl",style:{bottom:"0",left:"0",cursor:"nesw-resize",transform:"translate(-50%, 50%)"}},{name:"bm",style:{bottom:"0",left:"50%",cursor:"ns-resize",transform:"translate(-50%, 50%)"}},{name:"br",style:{bottom:"0",right:"0",cursor:"nwse-resize",transform:"translate(50%, 50%)"}}]));let O="";const z=p((()=>({x:[a.x,a.x+a.w/2,a.x+a.w],y:[a.y,a.y+a.h/2,a.y+a.h]})));function I(e){var t,a=new Image;a.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' %3E%3Cpath /%3E%3C/svg%3E",null==(t=null==e?void 0:e.dataTransfer)||t.setDragImage(a,0,0)}function U(e){return r=this,u=null,d=function*(){if(!(l&&s&&e.clientX&&e.clientY))return;const r=(null==i?void 0:i.scrollTop)||0,u=(null==i?void 0:i.scrollLeft)||0;let d=Math.ceil(e.clientX-l.left-s.offsetX)+u,c=Math.ceil(e.clientY-l.top-s.offsetY)+r;d>=0&&d+Number(a.w)<=l.width&&t("update:x",d),c>=0&&c+Number(a.h)<=l.height&&t("update:y",c),_((()=>{!function(){var e;if(!o)return;const r=null==(e=n.value)?void 0:e.filter((e=>e._id!==a.id)),l={row:[],col:[]};if(!r)return;const s=r.map((e=>({x:[e.x,e.x+e.w/2,e.x+e.w],y:[e.y,e.y+e.h/2,e.y+e.h]})));z.value.x.forEach((e=>{let n={};s.forEach(((o,r)=>{o.x.forEach((o=>{const l=e-o;Math.abs(l)<=10&&(t("update:x",a.x-l),n[o]?n[o].push(...s[r].y,...z.value.y):n[o]=[...s[r].y,...z.value.y])}))})),Object.keys(n).forEach((e=>{const t=Math.min(...n[Number(e)]),a=Math.max(...n[Number(e)]);l.col.push({top:t,left:Number(e),height:a-t})}))})),z.value.y.forEach((e=>{let n={};s.forEach(((o,r)=>{o.y.forEach((o=>{const l=e-o;Math.abs(l)<=10&&(t("update:y",a.y-l),n[o]?n[o].push(...s[r].x,...z.value.x):n[o]=[...s[r].x,...z.value.x])}))})),Object.keys(n).forEach((e=>{const t=Math.min(...n[Number(e)]),a=Math.max(...n[Number(e)]);l.row.push({top:Number(e),left:t,width:a-t})}))})),o(l)}()}))},new Promise(((e,t)=>{var a=e=>{try{o(d.next(e))}catch(a){t(a)}},n=e=>{try{o(d.throw(e))}catch(a){t(a)}},o=t=>t.done?e(t.value):Promise.resolve(t.value).then(a,n);o((d=d.apply(r,u)).next())}));var r,u,d}function C(e){e.stopPropagation(),s=null,o&&o(null)}function $(e){e.preventDefault()}function X(e){e.preventDefault()}function Y(e){var o;if(e.stopPropagation(),t("update:active",!0),null==(o=n.value)?void 0:o.length)for(let t of n.value)t._id!==a.id&&(t.active=!1);s=e}function B(e){O="",e.stopPropagation(),null==u||u.removeEventListener("mousemove",S,!0),null==u||u.removeEventListener("mouseup",B,!0)}function S(e){if(e.stopPropagation(),!s)return void console.warn("鼠标移动事件未触发");const{clientX:n,clientY:o}=e,{clientX:r,clientY:l}=s,i=n-r,u=o-l;"tl"===O?(t("update:x",a.x+i),t("update:y",a.y+u),t("update:w",a.w-i),t("update:h",a.h-u)):"tm"===O?(t("update:y",a.y+u),t("update:h",a.h-u)):"tr"===O?(t("update:y",a.y+u),t("update:w",a.w+i),t("update:h",a.h-u)):"mr"===O?t("update:w",a.w+i):"br"===O?(t("update:w",a.w+i),t("update:h",a.h+u)):"bm"===O?t("update:h",a.h+u):"bl"===O?(t("update:x",a.x+i),t("update:w",a.w-i),t("update:h",a.h+u)):"ml"===O&&(t("update:x",a.x+i),t("update:w",a.w-i)),s=e,_((()=>{}))}function q(e){console.log("触发mouseup"),e.stopPropagation(),s=null}return N((()=>a),(()=>{if(!n.value)return;const e=n.value.findIndex((e=>e._id===a.id));-1!==e?(n.value[e].w=a.w,n.value[e].h=a.h,n.value[e].x=a.x,n.value[e].y=a.y,n.value[e].active=a.active):n.value.push({_id:a.id,w:a.w,h:a.h,x:a.x,y:a.y,active:a.active})}),{immediate:!0,deep:!0}),E((()=>{_((()=>{u=document.getElementById("the-draggable-container"),l=(null==u?void 0:u.getBoundingClientRect())||null,i=document.getElementsByClassName("layout-content")[0],u&&(u.ondragover=function(e){e.preventDefault()})}))})),L((()=>{})),(e,t)=>(m(),v("div",{ref_key:"myself",ref:r,class:"the-draggable-item",style:x(k(c)),draggable:"true",onDragstart:I,onDrag:U,onDragend:C,onMousedown:Y,onMouseup:q,onDragenter:$,onDragove:X},[M(D("div",{class:w([a.active&&"active"])},[(m(!0),v(y,null,g(k(h),(e=>(m(),v("div",{key:e.name,class:"handle",style:x(e.style),onMousedown:P((t=>{return a=t,n=e.name,O=n,s=a,a.stopPropagation(),null==u||u.addEventListener("mousemove",S,!0),void(null==u||u.addEventListener("mouseup",B,!0));var a,n}),["stop","prevent"])},null,44,T)))),128))],2),[[j,a.active]]),f(e.$slots,"default",{},void 0,!0)],36))}})),[["__scopeId","data-v-c4bfe722"]]),B=I(u({__name:"index",setup(e){const t=d([{id:U(),x:100,y:100,w:100,h:120,active:!0,color:"black"},{id:U(),x:250,y:200,w:100,h:120,active:!1,color:"blue"},{id:U(),x:450,y:300,w:100,h:120,active:!1,color:"yellow"}]);function a(e){return{wdith:"100%",height:"100%",backgroundColor:e.color}}return(e,n)=>{const o=Y,r=$;return m(),O(r,{class:"container",grid:[15,15]},{default:z((()=>[(m(!0),v(y,null,g(k(t),(e=>(m(),O(o,{key:e.id,id:e.id,h:e.h,"onUpdate:h":t=>e.h=t,w:e.w,"onUpdate:w":t=>e.w=t,x:e.x,"onUpdate:x":t=>e.x=t,y:e.y,"onUpdate:y":t=>e.y=t,active:e.active,"onUpdate:active":t=>e.active=t},{default:z((()=>[D("div",{style:x(a(e))},null,4)])),_:2},1032,["id","h","onUpdate:h","w","onUpdate:w","x","onUpdate:x","y","onUpdate:y","active","onUpdate:active"])))),128))])),_:1})}}}),[["__scopeId","data-v-78f496c2"]]);export{B as default};
